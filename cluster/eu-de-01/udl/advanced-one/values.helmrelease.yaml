apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: advanced-one
  namespace: udl
spec:
  chartRef:
    kind: OCIRepository
    name: tf2chart
    namespace: default
  interval: 10m
  targetNamespace: udl
  values:
    replicaCount: 1

    workload:
      kind: Deployment # Deployment or StatefulSet
      nameOverride: "advanced-one"
      deploymentStrategy:
        type: Recreate

    statefulSet:
      serviceName: ""
      podManagementPolicy: OrderedReady
      updateStrategy: {}
      volumeClaimTemplates: []

    app:
      name: advanced-one
      image:
        repository: ghcr.io/udl-tf/tf2-image
        tag: latest
        pullPolicy: IfNotPresent
      containerPort: 58015
      ports:
        - name: game-udp
          containerPort: 58015
          protocol: UDP
      env:
        - name: SRCDS_PORT
          value: "58015"
      command: []
      args: []
      stdin: true
      tty: true
      livenessProbe: {}
      readinessProbe: {}
      startupProbe: {}
      resources: {}
      securityContext: {}
      extraVolumeMounts: []
      lifecycle: {}

    merger:
      enabled: true
      image:
        repository: alpine
        tag: latest
        pullPolicy: IfNotPresent
      resources: {}
      securityContext: {}
      extraEnv: []
      extraVolumeMounts: []
      watcher:
        enabled: true
        image:
          repository: alpine
          tag: latest
          pullPolicy: IfNotPresent
        installInotifyTools: true
        events:
          - close_write
          - create
          - delete
          - moved_to
          - moved_from
          - delete_self
          - move_self
        debounceSeconds: 2
        watchPaths: []
        command: []
        args: []
        env: []
        resources: {}
        securityContext: {}
        extraVolumeMounts: []
        watchBase: true

    initContainers:
      pre: []
      post: []

    permissionsInit:
      enabled: true
      image: busybox
      imagePullPolicy: IfNotPresent
      user: 1000
      group: 1000
      chmod: "775"
      path: ""

    paths:
      hostSource: /mnt/tf2
      hostPathType: Directory
      containerTarget: /tf

    overlays:
      - name: serverfiles-base
        path: /mnt/serverfiles
        sourcePath: serverfiles/base
        hostPathType: Directory
        readOnly: true
        watchParentDepth: 1
        extraWatchPaths:
          - /mnt/serverfiles/serverfiles
          - /mnt/serverfiles

    # Writable passthrough directories that map directly to the base host path.
    writablePaths:
      - tf/logs

    hostNetwork: false
    dnsPolicy: ""
    serviceAccountName: ""

    service:
      enabled: false
      type: ClusterIP
      port: 28015
      targetPort: 28015
      ports:
        - name: game-udp
          port: 28015
          targetPort: game-udp
          protocol: UDP
      nameOverride: ""
      headless: false
      clusterIP: ""
      externalTrafficPolicy: ""
      annotations: {}

    podAnnotations: {}
    podLabels: {}
    podSecurityContext: {}
    nodeSelector: {}
    tolerations: []
    affinity: {}
    priorityClassName: ""
    extraVolumes: []
